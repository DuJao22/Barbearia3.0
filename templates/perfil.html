{% extends "base.html" %}

{% block title %}Meu Perfil - {{ configuracoes_barbearia.nome_barbearia if configuracoes_barbearia else 'Barbearia Premium' }}{% endblock %}

{% block content %}
<div class="card">
    <h1><i class="fas fa-user"></i> Meu Perfil</h1>
    <p>Atualize suas informações pessoais</p>
</div>

<div class="grid-2">
    <div class="card">
        <h3><i class="fas fa-edit"></i> Editar Informações</h3>
        <form method="POST" enctype="multipart/form-data">
            <div class="form-group">
                <label for="nome">Nome Completo:</label>
                <input type="text" id="nome" name="nome" class="form-control" value="{{ usuario[1] }}" required>
            </div>

            <div class="form-group">
                <label for="telefone">Telefone:</label>
                <input type="text" id="telefone" name="telefone" class="form-control" value="{{ usuario[3] or '' }}" placeholder="(11) 99999-9999">
            </div>

            <div class="form-group">
                <label for="whatsapp">WhatsApp:</label>
                <input type="text" id="whatsapp" name="whatsapp" class="form-control" value="{{ usuario[4] or '' }}" placeholder="11999999999">
            </div>

            <div class="form-group">
                <label for="foto_perfil">Foto de Perfil:</label>
                <input type="file" id="foto_perfil" name="foto_perfil" class="form-control" accept="image/*">
                {% if usuario[5] %}
                    <small style="color: #666;">Foto atual: <img src="{{ usuario[5] }}" alt="Foto atual" style="width: 50px; height: 50px; border-radius: 50%; object-fit: cover; margin-left: 10px;"></small>
                {% endif %}
            </div>

            <button type="submit" class="btn">
                <i class="fas fa-save"></i> Salvar Alterações
            </button>
        </form>
    </div>

    <div class="card">
        <h3><i class="fas fa-info-circle"></i> Informações da Conta</h3>
        <div style="margin-bottom: 1rem;">
            <strong>Email:</strong> {{ usuario[2] }}
        </div>
        <div style="margin-bottom: 1rem;">
            <strong>Tipo de Conta:</strong> 
            {% if usuario[6] == 'admin' %}
                <span style="color: #dc3545; font-weight: bold;">Administrador</span>
            {% elif usuario[6] == 'funcionario' %}
                <span style="color: #007bff; font-weight: bold;">Funcionário</span>
            {% else %}
                <span style="color: #28a745; font-weight: bold;">Cliente</span>
            {% endif %}
        </div>

        {% if session.tipo_usuario == 'cliente' and fidelidade %}
        <div style="border-top: 1px solid #e1e5e9; padding-top: 1rem; margin-top: 1rem;">
            <h4><i class="fas fa-star"></i> Programa de Fidelidade</h4>
            <div style="margin-bottom: 0.5rem;">
                <strong>Cortes Realizados:</strong> {{ fidelidade[2] }}
            </div>
            <div style="margin-bottom: 0.5rem;">
                <strong>Cortes Gratuitos:</strong> {{ fidelidade[3] }}
            </div>
            <div style="margin-bottom: 0.5rem;">
                <strong>Próximo Gratuito em:</strong> {{ 10 - (fidelidade[2] % 10) }} cortes
            </div>
            
            <!-- Barra de Progresso -->
            <div class="progress-bar">
                <div class="progress-fill" style="width: {{ (fidelidade[2] % 10) * 10 }}%;"></div>
            </div>
            <small style="color: #bbb;">{{ fidelidade[2] % 10 }}/10 cortes para o próximo gratuito</small>
        </div>
        {% endif %}
    </div>
</div>

<div style="text-align: center; margin-top: 2rem;">
    {% if session.tipo_usuario == 'admin' %}
        <a href="{{ url_for('dashboard_admin') }}" class="btn btn-secondary">
            <i class="fas fa-arrow-left"></i> Voltar ao Dashboard
        </a>
    {% elif session.tipo_usuario == 'funcionario' %}
        <a href="{{ url_for('dashboard_funcionario') }}" class="btn btn-secondary">
            <i class="fas fa-arrow-left"></i> Voltar ao Dashboard
        </a>
    {% else %}
        <a href="{{ url_for('dashboard_cliente') }}" class="btn btn-secondary">
            <i class="fas fa-arrow-left"></i> Voltar ao Dashboard
        </a>
    {% endif %}
</div>
{% endblock %}